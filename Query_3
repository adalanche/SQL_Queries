Задача:

Вычислить прогресс пользователей по курсу. Прогресс вычисляется как отношение верно пройденных шагов к общему количеству 
шагов в процентах, округленное до целого. В нашей базе данные о решениях занесены не для всех шагов, поэтому общее 
количество шагов определить как количество различных шагов в таблице step_student.
Тем пользователям, которые прошли все шаги (прогресс = 100%) выдать "Сертификат с отличием". 
Тем, у кого прогресс больше или равен 80% - "Сертификат". Для остальных записей в столбце Результат задать пустую строку ("").
Информацию отсортировать по убыванию прогресса, затем по имени пользователя в алфавитном порядке.

Запрос:

SELECT *, IF (Прогресс = 100, 'Сертификат с отличием', IF(Прогресс <80, '', 'Сертификат')) AS Результат
FROM
    (
    SELECT Студент, 
        ROUND (SUM(IF (Верно>0, 1, 0))/(SELECT COUNT(DISTINCT step_id) FROM step_student)*100) AS Прогресс 
    FROM 
        (
        SELECT student_name AS Студент, step_id, SUM(IF(result='correct', 1, 0)) AS Верно
        FROM step_student JOIN student USING(student_id)
        GROUP BY 1, step_id
        ORDER BY 1
        ) AS sq1
    GROUP BY 1
    ) AS sq2
ORDER BY 2 DESC, 1
